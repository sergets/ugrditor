<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="xsl/project.xsl"?>
<thread xmlns:sxml="http://sergets.ru/sxml">
    <sxml:var name="thread" from="get" value="thread"/>
    <sxml:select what="title" from="threads" where="id = :thread" uses="thread" store="title"/>
    <title><sxml:value-of var="title"/></title>
    <id><sxml:value-of var="thread"/></id>
    <open-to>#</open-to>
    <sxml:select 
        tag="messages" entry="msg" entry-class="thread-message" attrs="sxml:time sxml:user thread" 
        sxml:enumerable="true" sxml:default-range="5-1" sxml:update="messages"
        from="mymessages" where="thread = :thread" uses="thread" sxml:id="messages"/>
    <sxml:action name="post">
        <sxml:var name="txt" from="post" value="txt"/>
        <sxml:var name="trd" from="post" value="trd"/>
        <sxml:update tag="messages"/>
        <sxml:insert into="mymessages" uses="txt trd">
            <thread>:trd</thread>
            <text>:txt</text>
        </sxml:insert>
    </sxml:action>
    <sxml:action name="edit">
        <sxml:var name="msg" from="post" value="msg"/>
        <sxml:var name="txt" from="post" value="txt"/>
        <sxml:update tag="messages"/>
        <sxml:edit in="mymessages" id=":msg" uses="msg txt">
            <text>:txt</text>
        </sxml:edit>
    </sxml:action>
    <sxml:action name="delete">
        <sxml:var name="msg" from="post" value="msg"/>
        <sxml:update tag="messages"/>
        <sxml:delete from="mymessages" id=":msg" uses="msg"/>
    </sxml:action>
</thread>